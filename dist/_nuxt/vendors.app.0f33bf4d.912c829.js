(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{369:function(t,e,n){"use strict";var o=n(7);e.a=function(){let t,e,n=null,r=null,l=null;const c={};let h,d,f,m,y,w,x,N={},k={},v={},T={},_={},A={},C={},j={};let M=o.default.SmoothShading;const O={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null};let S=1,I="Y",V=null;function X(text,c,M){if(n=(new DOMParser).parseFromString(text,"text/xml"),c=c||l,void 0!==M){const t=M.split("/");t.pop(),y=(t.length<1?".":t.join("/"))+"/"}!function(){const element=n.querySelectorAll("asset")[0];if(element&&element.childNodes)for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];switch(t.nodeName){case"unit":const meter=t.getAttribute("meter");meter&&(S=parseFloat(meter));break;case"up_axis":I=t.textContent.charAt(0)}}}(),function(){if(!0!==O.convertUpAxis||I===O.upAxis)V=null;else switch(I){case"X":V="Y"===O.upAxis?"XtoY":"XtoZ";break;case"Y":V="X"===O.upAxis?"YtoX":"YtoZ";break;case"Z":V="X"===O.upAxis?"ZtoX":"ZtoY"}}(),N=E("library_images image",H,"image"),_=E("library_materials material",gt,"material"),A=E("library_effects effect",Nt,"effect"),T=E("library_geometries geometry",nt,"geometry"),C=E("library_cameras camera",Ct,"camera"),j=E("library_lights light",Mt,"light"),v=E("library_controllers controller",J,"controller"),k=E("library_animations animation",vt,"animation"),f=E("library_visual_scenes visual_scene",$,"visual_scene"),m=E("library_kinematics_models kinematics_model",St,"kinematics_model"),w=[],x=[],t=function(){const t=n.querySelectorAll("scene instance_visual_scene")[0];if(t){const e=t.getAttribute("url").replace(/^#/,"");return f[e.length>0?e:"visual_scene0"]}return null}(),r=new o.default.Group;for(let i=0;i<t.nodes.length;i++)r.add(B(t.nodes[i]));r.scale.multiplyScalar(S),h=[],R(r),e=function(){const t=n.querySelectorAll("instance_kinematics_model")[0];if(t){const e=t.getAttribute("url").replace(/^#/,"");return m[e.length>0?e:"kinematics_model0"]}return null}(),function(){if(e&&0===e.joints.length)return void(d=void 0);const l={},c=function(n,o){const c=o.getAttribute("id"),h=t.getChildById(c,!0),d=e.joints[n];r.traverse((function(t){t.colladaId==c&&(l[n]={node:t,transforms:h.transforms,joint:d,position:d.zeroPosition})}))};d={joints:e&&e.joints,getJointValue(t){const e=l[t];if(e)return e.position;console.log("getJointValue: joint "+t+" doesn't exist")},setJointValue(t,e){const n=l[t];if(n){const r=n.joint;if(e>r.limits.max||e<r.limits.min)console.log("setJointValue: joint "+t+" value "+e+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+")");else if(r.static)console.log("setJointValue: joint "+t+" is static");else{const l=n.node,c=r.axis,h=n.transforms,d=new o.default.Matrix4;for(i=0;i<h.length;i++){const n=h[i];if(n.sid&&n.sid.includes("joint"+t))switch(r.type){case"revolute":d.multiply(m1.makeRotationAxis(c,o.default.Math.degToRad(e)));break;case"prismatic":d.multiply(m1.makeTranslation(c.x*e,c.y*e,c.z*e));break;default:console.warn("setJointValue: unknown joint type: "+r.type)}else{const t=new o.default.Matrix4;switch(n.type){case"matrix":d.multiply(n.obj);break;case"translate":d.multiply(t.makeTranslation(n.obj.x,n.obj.y,n.obj.z));break;case"rotate":d.multiply(t.makeRotationAxis(n.obj,n.angle))}}}const f=d.elements,m=Array.prototype.slice.call(f),y=[m[0],m[4],m[8],m[12],m[1],m[5],m[9],m[13],m[2],m[6],m[10],m[14],m[3],m[7],m[11],m[15]];l.matrix.set.apply(l.matrix,y),l.matrix.decompose(l.position,l.quaternion,l.scale)}}else console.log("setJointValue: joint "+t+" doesn't exist")}};const element=n.querySelector("scene instance_kinematics_scene");if(element)for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType&&"bind_joint_axis"===t.nodeName){const e=t.getAttribute("target").split("/").pop(),o=t.querySelector("axis param").textContent,r=parseInt(o.split("joint").pop().split(".")[0]),l=n.querySelector('[sid="'+e+'"]');if(l){c(r,l.parentElement)}}}}();const X={scene:r,morphs:w,skins:x,animations:h,kinematics:d,dae:{images:N,materials:_,cameras:C,lights:j,effects:A,geometries:T,controllers:v,animations:k,visualScenes:f,visualScene:t,scene:t,kinematicsModels:m,kinematicsModel:e}};return c&&c(X),X}function E(q,t,e){const o=n.querySelectorAll(q),r={};let i=0;const l=o.length;for(let n=0;n<l;n++){const element=o[n],l=(new t).parse(element);l.id&&0!==l.id.length||(l.id=e+i++),r[l.id]=l}return r}function R(e){const n=t.getChildById(e.colladaId,!0);let o=null;if(n&&n.keys){o={fps:60,hierarchy:[{node:n,keys:n.keys,sids:n.sids}],node:e,name:"animation_"+e.name,length:0},h.push(o);for(let i=0,t=n.keys.length;i<t;i++)o.length=Math.max(o.length,n.keys[i].time)}else o={hierarchy:[{keys:[],sids:[]}]};for(let i=0,t=e.children.length;i<t;i++){for(let t=0,n=R(e.children[i]).hierarchy.length;t<n;t++)o.hierarchy.push({keys:[],sids:[]})}return o}function L(t,e){const n=e instanceof et?v[e.url]:e;if(!n||!n.morph)return void console.log("could not find morph controller!");const o=n.morph;for(let i=0;i<o.targets.length;i++){const e=o.targets[i],n=T[e];if(!n.mesh||!n.mesh.primitives||!n.mesh.primitives.length)continue;const r=n.mesh.primitives[0].geometry;r.vertices.length===t.vertices.length&&t.morphTargets.push({name:"target_1",vertices:r.vertices})}t.morphTargets.push({name:"target_Z",vertices:t.vertices})}function Y(t,e,n,r){if(t.world=t.world||new o.default.Matrix4,t.localworld=t.localworld||new o.default.Matrix4,t.world.copy(t.matrix),t.localworld.copy(t.matrix),t.channels&&t.channels.length){const e=t.channels[0].sampler.output[n];e instanceof o.default.Matrix4&&(t.world.copy(e),t.localworld.copy(e),0===n&&t.matrix.copy(e))}r&&t.world.multiplyMatrices(r,t.world),e.push(t);for(let i=0;i<t.nodes.length;i++)Y(t.nodes[i],e,n,t.world)}function Z(t,e){for(let i=0;i<t.length;i++){const n=t[i];let r=-1;if("JOINT"==n.type){for(let t=0;t<e.joints.length;t++)if(n.sid===e.joints[t]){r=t;break}if(r>=0){const t=e.invBindMatrices[r];n.invBindMatrix=t,n.skinningMatrix=new o.default.Matrix4,n.skinningMatrix.multiplyMatrices(n.world,t),n.animatrix=new o.default.Matrix4,n.animatrix.copy(n.localworld),n.weights=[];for(let t=0;t<e.weights.length;t++)for(let o=0;o<e.weights[t].length;o++){const l=e.weights[t][o];l.joint===r&&n.weights.push(l)}}else console.warn("ColladaLoader: Could not find joint '"+n.sid+"'."),n.skinningMatrix=new o.default.Matrix4,n.weights=[]}}}function z(t,e,n){const r=[];Y(e,r,-1),Z(r,n.skin);const l=new o.default.Vector3,c=[];for(let i=0;i<t.vertices.length;i++)c.push(new o.default.Vector3);for(i=0;i<r.length;i++)if("JOINT"==r[i].type)for(let e=0;e<r[i].weights.length;e++){const n=r[i].weights[e],o=n.index,h=n.weight,d=t.vertices[o],s=c[o];l.x=d.x,l.y=d.y,l.z=d.z,l.applyMatrix4(r[i].skinningMatrix),s.x+=l.x*h,s.y+=l.y*h,s.z+=l.z*h}for(let i=0;i<t.vertices.length;i++)t.vertices[i]=c[i]}function F(e,n,r){const l=v[n.url];if(r=void 0!==r?r:40,!l||!l.skin)return void console.log("ColladaLoader: Could not find skin controller.");if(!n.skeleton||!n.skeleton.length)return void console.log("ColladaLoader: Could not find the skeleton for the skin. ");const c=function(){let t,e=1e6,n=-e,o=0;for(const r in k){const l=k[r];t=t||l.id;for(let i=0;i<l.sampler.length;i++){const t=l.sampler[i];t.create(),e=Math.min(e,t.startTime),n=Math.max(n,t.endTime),o=Math.max(o,t.input.length)}}return{start:e,end:n,frames:o,ID:t}}(),h=t.getChildById(n.skeleton[0],!0)||t.getChildBySid(n.skeleton[0],!0),d=function(t){const e=[],n=function(t,e,r){const l={};l.name=e.sid,l.parent=t,l.matrix=e.matrix;const data=[new o.default.Vector3,new o.default.Quaternion,new o.default.Vector3];l.matrix.decompose(data[0],data[1],data[2]),l.pos=[data[0].x,data[0].y,data[0].z],l.scl=[data[2].x,data[2].y,data[2].z],l.rotq=[data[1].x,data[1].y,data[1].z,data[1].w],r.push(l);for(const i in e.nodes)n(e.sid,e.nodes[i],r)};return n(-1,t,e),e}(h),f=l.skin.joints,m=[];for(let i=0;i<f.length;i++)for(let t=0;t<d.length;t++)d[t].name===f[i]&&(m[i]=d[t]);for(let i=0;i<m.length;i++)for(let t=0;t<m.length;t++)m[i].parent===m[t].name&&(m[i].parent=t);let i;new o.default.Vector3;for(i=0;i<e.vertices.length;i++)e.vertices[i].applyMatrix4(l.skin.bindShapeMatrix);const y=[],w=[],x=l.skin.weights;for(let i=0;i<x.length;i++){const t=new o.default.Vector4(x[i][0]?x[i][0].joint:0,x[i][1]?x[i][1].joint:0,x[i][2]?x[i][2].joint:0,x[i][3]?x[i][3].joint:0),e=new o.default.Vector4(x[i][0]?x[i][0].weight:0,x[i][1]?x[i][1].weight:0,x[i][2]?x[i][2].weight:0,x[i][3]?x[i][3].weight:0);y.push(t),w.push(e)}e.skinIndices=y,e.skinWeights=w,e.bones=m;const N={name:c.ID,fps:30,length:c.frames/30,hierarchy:[]};for(let t=0;t<m.length;t++)N.hierarchy.push({parent:m[t].parent,name:m[t].name,keys:[]});for(console.log("ColladaLoader:",c.ID+" has "+m.length+" bones."),z(e,h,l),r=0;r<c.frames;r++){const t=[];Y(h,t,r),Z(t,l.skin);for(let i=0;i<t.length;i++)for(let e=0;e<N.hierarchy.length;e++)if(N.hierarchy[e].name===t[i].sid){const n={};n.time=r/30,n.matrix=t[i].animatrix,0===r&&(t[i].matrix=n.matrix);const data=[new o.default.Vector3,new o.default.Quaternion,new o.default.Vector3];n.matrix.decompose(data[0],data[1],data[2]),n.pos=[data[0].x,data[0].y,data[0].z],n.scl=[data[2].x,data[2].y,data[2].z],n.rot=data[1],N.hierarchy[e].keys.push(n)}e.animation=N}}function B(t,e){const n=new o.default.Object3D;let r,l,i,c,h=!1;for(i=0;i<t.controllers.length;i++){const e=v[t.controllers[i].url];switch(e.type){case"skin":if(T[e.skin.source]){const n=new it;n.url=e.skin.source,n.instance_material=t.controllers[i].instance_material,t.geometries.push(n),h=!0,r=t.controllers[i]}else if(v[e.skin.source]){const n=v[e.skin.source];if(l=n,n.morph&&T[n.morph.source]){const e=new it;e.url=n.morph.source,e.instance_material=t.controllers[i].instance_material,t.geometries.push(e)}}break;case"morph":if(T[e.morph.source]){const n=new it;n.url=e.morph.source,n.instance_material=t.controllers[i].instance_material,t.geometries.push(n),l=t.controllers[i]}console.log("ColladaLoader: Morph-controller partially supported.")}}const d={};for(i=0;i<t.geometries.length;i++){const e=t.geometries[i],h=e.instance_material,f=T[e.url],m={},y=[];let N,k=0;if(f){if(!f.mesh||!f.mesh.primitives)continue;if(0===n.name.length&&(n.name=f.id),h)for(c=0;c<h.length;c++){const t=h[c],e=_[t.target],n=e.instance_effect.url;let r=A[n].shader.material;if(f.doubleSided){if(!(t.symbol in d)){const e=r.clone();e.side=o.default.DoubleSide,d[t.symbol]=e}r=d[t.symbol]}r.opacity=r.opacity?r.opacity:1,m[t.symbol]=k,y.push(r),N=r,N.name=null===e.name||""===e.name?e.id:e.name,k++}let t,e=N||new o.default.MeshLambertMaterial({color:14540253,side:f.doubleSided?o.default.DoubleSide:o.default.FrontSide});const v=f.mesh.geometry3js;k>1&&(e=new o.default.MultiMaterial(y)),void 0!==r?(F(v,r),v.morphTargets.length>0?(e.morphTargets=!0,e.skinning=!1):(e.morphTargets=!1,e.skinning=!0),t=new o.default.SkinnedMesh(v,e,!1),t.name="skin_"+x.length,x.push(t)):void 0!==l?(L(v,l),e.morphTargets=!0,t=new o.default.Mesh(v,e),t.name="morph_"+w.length,w.push(t)):t=!0===v.isLineStrip?new o.default.Line(v):new o.default.Mesh(v,e),n.add(t)}}for(i=0;i<t.cameras.length;i++){const e=t.cameras[i],r=C[e.url],l=new o.default.PerspectiveCamera(r.yfov,parseFloat(r.aspect_ratio),parseFloat(r.znear),parseFloat(r.zfar));n.add(l)}for(i=0;i<t.lights.length;i++){let e=null;const r=t.lights[i],l=j[r.url];if(l&&l.technique){const t=l.color.getHex(),n=l.intensity,r=l.distance,c=l.falloff_angle;switch(l.technique){case"directional":e=new o.default.DirectionalLight(t,n,r),e.position.set(0,0,1);break;case"point":e=new o.default.PointLight(t,n,r);break;case"spot":e=new o.default.SpotLight(t,n,r,c),e.position.set(0,0,1);break;case"ambient":e=new o.default.AmbientLight(t)}}e&&n.add(e)}if(n.name=t.name||t.id||"",n.colladaId=t.id||"",n.layer=t.layer||"",n.matrix=t.matrix,n.matrix.decompose(n.position,n.quaternion,n.scale),O.centerGeometry&&n.geometry){const t=n.geometry.center();t.multiply(n.scale),t.applyQuaternion(n.quaternion),n.position.sub(t)}for(i=0;i<t.nodes.length;i++)n.add(B(t.nodes[i],t));return n}function D(t){const e=n.querySelectorAll("library_nodes node");for(let i=0;i<e.length;i++){const n=e[i].attributes.getNamedItem("id");if(n&&n.value===t)return e[i]}}function U(t,time){let e=null;for(let i=0,n=t.length;i<n&&null===e;i++){const n=t[i];if(n.time===time)e=n;else if(n.time>time)break}return e}function P(t,time){let e=-1;for(let i=0,n=t.length;i<n&&-1===e;i++){t[i].time>=time&&(e=i)}return e}function G(t,e,n,o){const r=function(t,e,n){for(n=n>=0?n:n+t.length;n>=0;n--){const o=t[n];if(o.hasTarget(e))return o}return null}(t,o,n?n-1:0),l=function(t,e,n){for(;n<t.length;n++){const o=t[n];if(o.hasTarget(e))return o}return null}(t,o,n+1);if(r&&l){const t=(e.time-r.time)/(l.time-r.time),n=r.getTarget(o),c=l.getTarget(o).data,h=n.data;let data;if("matrix"===n.type)data=h;else if(h.length){data=[];for(let i=0;i<h.length;++i)data[i]=h[i]+(c[i]-h[i])*t}else data=h+(c-h)*t;e.addTarget(o,n.transform,n.member,data)}}function H(){this.id="",this.init_from=""}function J(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function W(){this.method=null,this.source=null,this.targets=null,this.weights=null}function Q(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function $(){this.id="",this.name="",this.nodes=[],this.scene=new o.default.Group}function K(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new o.default.Matrix4}function tt(){this.sid="",this.type="",this.data=[],this.obj=null}function et(){this.url="",this.skeleton=[],this.instance_material=[]}function st(){this.symbol="",this.target=""}function it(){this.url="",this.instance_material=[]}function nt(){this.id="",this.mesh=null}function ot(t){this.geometry=t.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function at(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new o.default.Geometry}function lt(){at.call(this),this.vcount=[]}function ct(){at.call(this),this.vcount=1}function ht(){at.call(this),this.vcount=3}function ut(){this.source="",this.count=0,this.stride=0,this.params=[]}function pt(){this.input={}}function ft(){this.semantic="",this.offset=0,this.source="",this.set=0}function mt(t){this.id=t,this.type=null}function gt(){this.id="",this.name="",this.instance_effect=null}function yt(){this.color=new o.default.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function bt(t,e){this.type=t,this.effect=e,this.material=null}function wt(t){this.effect=t,this.init_from=null,this.format=null}function xt(t){this.effect=t,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function Nt(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function kt(){this.url=""}function vt(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function Tt(t){this.animation=t,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function _t(t){this.id="",this.animation=t,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function At(time){this.targets=[],this.time=time}function Ct(){this.id="",this.name="",this.technique=""}function jt(){this.url=""}function Mt(){this.id="",this.name="",this.technique=""}function Ot(){this.url=""}function St(){this.id="",this.name="",this.joints=[],this.links=[]}function It(){this.sid="",this.name="",this.axis=new o.default.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function qt(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function Vt(){this.joint="",this.transforms=[],this.links=[]}function Xt(element){const t=element.getAttribute("id");return null!=c[t]||(c[t]=new mt(t).parse(element)),c[t]}function Et(t){const e=Yt(t),data=[];for(let i=0,t=e.length;i<t;i++)data.push(!("true"!==e[i]&&"1"!==e[i]));return data}function Rt(t){const e=Yt(t),data=[];for(let i=0,t=e.length;i<t;i++)data.push(parseFloat(e[i]));return data}function Lt(t){const e=Yt(t),data=[];for(let i=0,t=e.length;i<t;i++)data.push(parseInt(e[i],10));return data}function Yt(t){return t.length>0?function(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}(t).split(/\s+/):[]}function Zt(element,t,e){return element.hasAttribute(t)?parseInt(element.getAttribute(t),10):e}function zt(t,e){(new o.default.ImageLoader).load(e,(function(image){t.image=image,t.needsUpdate=!0}))}function Ft(t,element){t.doubleSided=!1;const e=element.querySelectorAll("extra double_sided")[0];e&&e&&1===parseInt(e.textContent,10)&&(t.doubleSided=!0)}function Bt(data,t){if(!0===O.convertUpAxis&&I!==O.upAxis)switch(V){case"XtoY":const e=data[0];data[0]=t*data[1],data[1]=e;break;case"XtoZ":const n=data[2];data[2]=data[1],data[1]=data[0],data[0]=n;break;case"YtoX":const o=data[0];data[0]=data[1],data[1]=t*o;break;case"YtoZ":const r=data[1];data[1]=t*data[2],data[2]=r;break;case"ZtoX":const l=data[0];data[0]=data[1],data[1]=data[2],data[2]=l;break;case"ZtoY":const c=data[1];data[1]=data[2],data[2]=t*c}}function Dt(data,t){const e=[data[t],data[t+1],data[t+2]];return Bt(e,-1),new o.default.Vector3(e[0],e[1],e[2])}function Ut(data){if(O.convertUpAxis){let t=[data[0],data[4],data[8]];Bt(t,-1),data[0]=t[0],data[4]=t[1],data[8]=t[2],t=[data[1],data[5],data[9]],Bt(t,-1),data[1]=t[0],data[5]=t[1],data[9]=t[2],t=[data[2],data[6],data[10]],Bt(t,-1),data[2]=t[0],data[6]=t[1],data[10]=t[2],t=[data[0],data[1],data[2]],Bt(t,-1),data[0]=t[0],data[1]=t[1],data[2]=t[2],t=[data[4],data[5],data[6]],Bt(t,-1),data[4]=t[0],data[5]=t[1],data[6]=t[2],t=[data[8],data[9],data[10]],Bt(t,-1),data[8]=t[0],data[9]=t[1],data[10]=t[2],t=[data[3],data[7],data[11]],Bt(t,-1),data[3]=t[0],data[7]=t[1],data[11]=t[2]}return(new o.default.Matrix4).set(data[0],data[1],data[2],data[3],data[4],data[5],data[6],data[7],data[8],data[9],data[10],data[11],data[12],data[13],data[14],data[15])}function Pt(t){if(t>-1&&t<3){t={X:0,Y:1,Z:2}[t=Gt(["X","Y","Z"][t])]}return t}function Gt(t){if(O.convertUpAxis)switch(t){case"X":switch(V){case"XtoY":case"XtoZ":case"YtoX":t="Y";break;case"ZtoX":t="Z"}break;case"Y":switch(V){case"XtoY":case"YtoX":case"ZtoX":t="X";break;case"XtoZ":case"YtoZ":case"ZtoY":t="Z"}break;case"Z":switch(V){case"XtoZ":t="X";break;case"YtoZ":case"ZtoX":case"ZtoY":t="Y"}}return t}return H.prototype.parse=function(element){this.id=element.getAttribute("id");for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];"init_from"===t.nodeName&&(this.init_from=t.textContent)}return this},J.prototype.parse=function(element){this.id=element.getAttribute("id"),this.name=element.getAttribute("name"),this.type="none";for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];switch(t.nodeName){case"skin":this.skin=(new Q).parse(t),this.type=t.nodeName;break;case"morph":this.morph=(new W).parse(t),this.type=t.nodeName}}return this},W.prototype.parse=function(element){const t={};let i,e=[];for(this.method=element.getAttribute("method"),this.source=element.getAttribute("source").replace(/^#/,""),i=0;i<element.childNodes.length;i++){const n=element.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"source":const source=(new mt).parse(n);t[source.id]=source;break;case"targets":e=this.parseInputs(n);break;default:console.log(n.nodeName)}}for(i=0;i<e.length;i++){const input=e[i],source=t[input.source];switch(input.semantic){case"MORPH_TARGET":this.targets=source.read();break;case"MORPH_WEIGHT":this.weights=source.read()}}return this},W.prototype.parseInputs=function(element){const t=[];for(let i=0;i<element.childNodes.length;i++){const e=element.childNodes[i];if(1==e.nodeType&&"input"===e.nodeName)t.push((new ft).parse(e))}return t},Q.prototype.parse=function(element){const t={};let e,n;this.source=element.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(let i=0;i<element.childNodes.length;i++){const o=element.childNodes[i];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":const r=Rt(o.textContent);this.bindShapeMatrix=Ut(r);break;case"source":const l=(new mt).parse(o);t[l.id]=l;break;case"joints":e=o;break;case"vertex_weights":n=o;break;default:console.log(o.nodeName)}}return this.parseJoints(e,t),this.parseWeights(n,t),this},Q.prototype.parseJoints=function(element,t){for(let i=0;i<element.childNodes.length;i++){const e=element.childNodes[i];if(1==e.nodeType&&"input"===e.nodeName){const input=(new ft).parse(e),source=t[input.source];"JOINT"===input.semantic?this.joints=source.read():"INV_BIND_MATRIX"===input.semantic&&(this.invBindMatrices=source.read())}}},Q.prototype.parseWeights=function(element,t){let e,n;const o=[];for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(t.nodeName){case"input":o.push((new ft).parse(t));break;case"v":e=Lt(t.textContent);break;case"vcount":n=Lt(t.textContent)}}let r=0;for(let i=0;i<n.length;i++){const l=n[i],c=[];for(let n=0;n<l;n++){const n={};for(let l=0;l<o.length;l++){const input=o[l],c=e[r+input.offset];switch(input.semantic){case"JOINT":n.joint=c;break;case"WEIGHT":n.weight=t[input.source].data[c]}}c.push(n),r+=o.length}for(let t=0;t<c.length;t++)c[t].index=i;this.weights.push(c)}},$.prototype.getChildById=function(t,e){for(let i=0;i<this.nodes.length;i++){const n=this.nodes[i].getChildById(t,e);if(n)return n}return null},$.prototype.getChildBySid=function(t,e){for(let i=0;i<this.nodes.length;i++){const n=this.nodes[i].getChildBySid(t,e);if(n)return n}return null},$.prototype.parse=function(element){this.id=element.getAttribute("id"),this.name=element.getAttribute("name"),this.nodes=[];for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType&&"node"===t.nodeName)this.nodes.push((new K).parse(t))}return this},K.prototype.getChannelForTransform=function(t){for(let i=0;i<this.channels.length;i++){const e=this.channels[i];let n=e.target.split("/");n.shift();let o=n.shift();const r=o.includes("."),l=o.includes("(");let c,h;if(r)n=o.split("."),o=n.shift(),h=n.shift();else if(l){c=o.split("("),o=c.shift();for(let t=0;t<c.length;t++)c[t]=parseInt(c[t].replace(/\)/,""))}if(o===t)return e.info={sid:o,dotSyntax:r,arrSyntax:l,arrIndices:c},e}return null},K.prototype.getChildById=function(t,e){if(this.id===t)return this;if(e)for(let i=0;i<this.nodes.length;i++){const n=this.nodes[i].getChildById(t,e);if(n)return n}return null},K.prototype.getChildBySid=function(t,e){if(this.sid===t)return this;if(e)for(let i=0;i<this.nodes.length;i++){const n=this.nodes[i].getChildBySid(t,e);if(n)return n}return null},K.prototype.getTransformBySid=function(t){for(let i=0;i<this.transforms.length;i++)if(this.transforms[i].sid===t)return this.transforms[i];return null},K.prototype.parse=function(element){let t;this.id=element.getAttribute("id"),this.sid=element.getAttribute("sid"),this.name=element.getAttribute("name"),this.type=element.getAttribute("type"),this.layer=element.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new o.default.Matrix4;for(let i=0;i<element.childNodes.length;i++){const e=element.childNodes[i];if(1==e.nodeType)switch(e.nodeName){case"node":this.nodes.push((new K).parse(e));break;case"instance_camera":this.cameras.push((new jt).parse(e));break;case"instance_controller":this.controllers.push((new et).parse(e));break;case"instance_geometry":this.geometries.push((new it).parse(e));break;case"instance_light":this.lights.push((new Ot).parse(e));break;case"instance_node":t=e.getAttribute("url").replace(/^#/,"");const n=D(t);n&&this.nodes.push((new K).parse(n));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new tt).parse(e));break;case"extra":break;default:console.log(e.nodeName)}}return this.channels=function(t){const e=[];let n=1e6,o=-1e6;for(const r in k){const l=k[r];for(let i=0;i<l.channel.length;i++){const r=l.channel[i],c=l.sampler[i];r.target.split("/")[0]==t.id&&(c.create(),r.sampler=c,n=Math.min(n,c.startTime),o=Math.max(o,c.endTime),e.push(r))}}return e.length&&(t.startTime=n,t.endTime=o),e}(this),function(t){if(t.channels&&t.channels.length){const e=[],n=[];for(let i=0,o=t.channels.length;i<o;i++){const o=t.channels[i],r=o.fullSid,l=o.sampler,input=l.input,c=t.getTransformBySid(o.sid);let h;if(o.arrIndices){h=[];for(let t=0,e=o.arrIndices.length;t<e;t++)h[t]=Pt(o.arrIndices[t])}else h=Gt(o.member);if(c){n.includes(r)||n.push(r);for(let t=0,n=input.length;t<n;t++){const time=input[t],data=l.getData(c.type,t,h);let n=U(e,time);if(!n){n=new At(time);const t=P(e,time);e.splice(-1===t?e.length:t,0,n)}n.addTarget(r,c,h,data)}}else console.log('Could not find transform "'+o.sid+'" in node '+t.id)}for(let i=0;i<n.length;i++){const t=n[i];for(let n=0;n<e.length;n++){const o=e[n];o.hasTarget(t)||G(e,o,n,t)}}t.keys=e,t.sids=n}}(this),this.updateMatrix(),this},K.prototype.updateMatrix=function(){this.matrix.identity();for(let i=0;i<this.transforms.length;i++)this.transforms[i].apply(this.matrix)},tt.prototype.parse=function(element){return this.sid=element.getAttribute("sid"),this.type=element.nodeName,this.data=Rt(element.textContent),this.convert(),this},tt.prototype.convert=function(){switch(this.type){case"matrix":this.obj=Ut(this.data);break;case"rotate":this.angle=o.default.Math.degToRad(this.data[3]);case"translate":Bt(this.data,-1),this.obj=new o.default.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":Bt(this.data,1),this.obj=new o.default.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},tt.prototype.apply=function(){const t=new o.default.Matrix4;return function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.multiply(t.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":e.multiply(t.makeRotationAxis(this.obj,this.angle));break;case"scale":e.scale(this.obj)}}}(),tt.prototype.update=function(data,t){const e=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=data[0],this.obj.n21=data[1],this.obj.n31=data[2],this.obj.n41=data[3];break;case 1:this.obj.n12=data[0],this.obj.n22=data[1],this.obj.n32=data[2],this.obj.n42=data[3];break;case 2:this.obj.n13=data[0],this.obj.n23=data[1],this.obj.n33=data[2],this.obj.n43=data[3];break;case 3:this.obj.n14=data[0],this.obj.n24=data[1],this.obj.n34=data[2],this.obj.n44=data[3]}else if(2===t.length){const e="n"+(t[0]+1)+(t[1]+1);this.obj[e]=data}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(data);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=e[t[0]]),t){case"X":this.obj.x=data;break;case"Y":this.obj.y=data;break;case"Z":this.obj.z=data;break;default:this.obj.x=data[0],this.obj.y=data[1],this.obj.z=data[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=e[t[0]]),t){case"X":this.obj.x=data;break;case"Y":this.obj.y=data;break;case"Z":this.obj.z=data;break;case"ANGLE":this.angle=o.default.Math.degToRad(data);break;default:this.obj.x=data[0],this.obj.y=data[1],this.obj.z=data[2],this.angle=o.default.Math.degToRad(data[3])}}},et.prototype.parse=function(element){this.url=element.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1===t.nodeType)switch(t.nodeName){case"skeleton":this.skeleton.push(t.textContent.replace(/^#/,""));break;case"bind_material":const e=t.querySelectorAll("instance_material");for(let t=0;t<e.length;t++){const n=e[t];this.instance_material.push((new st).parse(n))}}}return this},st.prototype.parse=function(element){return this.symbol=element.getAttribute("symbol"),this.target=element.getAttribute("target").replace(/^#/,""),this},it.prototype.parse=function(element){this.url=element.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType&&"bind_material"===t.nodeName){const e=t.querySelectorAll("instance_material");for(let t=0;t<e.length;t++){const n=e[t];this.instance_material.push((new st).parse(n))}break}}return this},nt.prototype.parse=function(element){this.id=element.getAttribute("id"),Ft(this,element);for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if("mesh"===t.nodeName)this.mesh=new ot(this).parse(t)}return this},ot.prototype.parse=function(element){this.primitives=[];for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];switch(t.nodeName){case"source":Xt(t);break;case"vertices":this.vertices=(new pt).parse(t);break;case"linestrips":this.primitives.push((new ct).parse(t));break;case"triangles":this.primitives.push((new ht).parse(t));break;case"polygons":this.primitives.push((new at).parse(t));break;case"polylist":this.primitives.push((new lt).parse(t))}}if(this.geometry3js=new o.default.Geometry,null===this.vertices)return this;const t=c[this.vertices.input.POSITION.source].data;for(let i=0;i<t.length;i+=3)this.geometry3js.vertices.push(Dt(t,i).clone());for(let i=0;i<this.primitives.length;i++){const t=this.primitives[i];t.setVertices(this.vertices),this.handlePrimitive(t,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},ot.prototype.handlePrimitive=function(t,e){if(t instanceof ct)return void(e.isLineStrip=!0);let n,r;const l=t.p,h=t.inputs;let input,d,f,source,m,y=0,w=3,x=0;const N=[];for(n=0;n<h.length;n++){input=h[n];const t=input.offset+1;if(x=x<t?t:x,"TEXCOORD"===input.semantic)N.push(input.set)}for(let k=0;k<l.length;++k){const p=l[k];let i=0;for(;i<p.length;){const l=[],k=[];let v=null;const T=[];for(w=t.vcount?t.vcount.length?t.vcount[y++]:t.vcount:p.length/x,n=0;n<w;n++)for(r=0;r<h.length;r++)switch(input=h[r],source=c[input.source],d=p[i+n*x+input.offset],m=source.accessor.params.length,f=d*m,input.semantic){case"VERTEX":l.push(d);break;case"NORMAL":k.push(Dt(source.data,f));break;case"TEXCOORD":v=v||{},void 0===v[input.set]&&(v[input.set]=[]),v[input.set].push(new o.default.Vector2(source.data[f],source.data[f+1]));break;case"COLOR":T.push((new o.default.Color).setRGB(source.data[f],source.data[f+1],source.data[f+2]))}if(0===k.length)if(input=this.vertices.input.NORMAL,input){source=c[input.source],m=source.accessor.params.length;for(let t=0,e=l.length;t<e;t++)k.push(Dt(source.data,l[t]*m))}else e.calcNormals=!0;if(!v&&(v={},input=this.vertices.input.TEXCOORD,input)){N.push(input.set),source=c[input.source],m=source.accessor.params.length;for(let t=0,e=l.length;t<e;t++)f=l[t]*m,void 0===v[input.set]&&(v[input.set]=[]),v[input.set].push(new o.default.Vector2(source.data[f],1-source.data[f+1]))}if(0===T.length&&(input=this.vertices.input.COLOR,input)){source=c[input.source],m=source.accessor.params.length;for(let t=0,e=l.length;t<e;t++)f=l[t]*m,T.push((new o.default.Color).setRGB(source.data[f],source.data[f+1],source.data[f+2]))}let _=null;const A=[];let C,j;if(3===w)A.push(new o.default.Face3(l[0],l[1],l[2],k,T.length?T:new o.default.Color));else if(4===w)A.push(new o.default.Face3(l[0],l[1],l[3],k.length?[k[0].clone(),k[1].clone(),k[3].clone()]:[],T.length?[T[0],T[1],T[3]]:new o.default.Color)),A.push(new o.default.Face3(l[1],l[2],l[3],k.length?[k[1].clone(),k[2].clone(),k[3].clone()]:[],T.length?[T[1],T[2],T[3]]:new o.default.Color));else if(w>4&&O.subdivideFaces){const t=T.length?T:new o.default.Color;for(r=1;r<w-1;)A.push(new o.default.Face3(l[0],l[r],l[r+1],k.length?[k[0].clone(),k[r++].clone(),k[r].clone()]:[],t))}if(A.length)for(let n=0,o=A.length;n<o;n++)for(_=A[n],_.daeMaterial=t.material,e.faces.push(_),r=0;r<N.length;r++)C=v[N[r]],j=w>4?[C[0],C[n+1],C[n+2]]:4===w?0===n?[C[0],C[1],C[3]]:[C[1].clone(),C[2],C[3].clone()]:[C[0],C[1],C[2]],void 0===e.faceVertexUvs[r]&&(e.faceVertexUvs[r]=[]),e.faceVertexUvs[r].push(j);else console.log("dropped face with vcount "+w+" for geometry with id: "+e.id);i+=x*w}}},at.prototype.setVertices=function(t){for(let i=0;i<this.inputs.length;i++)this.inputs[i].source===t.id&&(this.inputs[i].source=t.input.POSITION.source)},at.prototype.parse=function(element){this.material=element.getAttribute("material"),this.count=Zt(element,"count",0);for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];switch(t.nodeName){case"input":this.inputs.push((new ft).parse(element.childNodes[i]));break;case"vcount":this.vcount=Lt(t.textContent);break;case"p":this.p.push(Lt(t.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},lt.prototype=Object.create(at.prototype),lt.prototype.constructor=lt,ct.prototype=Object.create(at.prototype),ct.prototype.constructor=ct,ht.prototype=Object.create(at.prototype),ht.prototype.constructor=ht,ut.prototype.parse=function(element){this.params=[],this.source=element.getAttribute("source"),this.count=Zt(element,"count",0),this.stride=Zt(element,"stride",0);for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if("param"===t.nodeName){const param={};param.name=t.getAttribute("name"),param.type=t.getAttribute("type"),this.params.push(param)}}return this},pt.prototype.parse=function(element){this.id=element.getAttribute("id");for(let i=0;i<element.childNodes.length;i++)if("input"===element.childNodes[i].nodeName){const input=(new ft).parse(element.childNodes[i]);this.input[input.semantic]=input}return this},ft.prototype.parse=function(element){return this.semantic=element.getAttribute("semantic"),this.source=element.getAttribute("source").replace(/^#/,""),this.set=Zt(element,"set",-1),this.offset=Zt(element,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},mt.prototype.parse=function(element){this.id=element.getAttribute("id");for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];switch(t.nodeName){case"bool_array":this.data=Et(t.textContent),this.type=t.nodeName;break;case"float_array":this.data=Rt(t.textContent),this.type=t.nodeName;break;case"int_array":this.data=Lt(t.textContent),this.type=t.nodeName;break;case"IDREF_array":case"Name_array":this.data=Yt(t.textContent),this.type=t.nodeName;break;case"technique_common":for(let e=0;e<t.childNodes.length;e++)if("accessor"===t.childNodes[e].nodeName){this.accessor=(new ut).parse(t.childNodes[e]);break}}}return this},mt.prototype.read=function(){const t=[],param=this.accessor.params[0];switch(param.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(let e=0;e<this.data.length;e+=16){const n=Ut(this.data.slice(e,e+16));t.push(n)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+param.type+".")}return t},gt.prototype.parse=function(element){this.id=element.getAttribute("id"),this.name=element.getAttribute("name");for(let i=0;i<element.childNodes.length;i++)if("instance_effect"===element.childNodes[i].nodeName){this.instance_effect=(new kt).parse(element.childNodes[i]);break}return this},yt.prototype.isColor=function(){return null===this.texture},yt.prototype.isTexture=function(){return null!=this.texture},yt.prototype.parse=function(element){"transparent"===element.nodeName&&(this.opaque=element.getAttribute("opaque"));for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(t.nodeName){case"color":const e=Rt(t.textContent);this.color=new o.default.Color,this.color.setRGB(e[0],e[1],e[2]),this.color.a=e[3];break;case"texture":this.texture=t.getAttribute("texture"),this.texcoord=t.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(t)}}return this},yt.prototype.parseTexture=function(element){if(!element.childNodes)return this;element.childNodes[1]&&"extra"===element.childNodes[1].nodeName&&(element=element.childNodes[1]).childNodes[1]&&"technique"===element.childNodes[1].nodeName&&(element=element.childNodes[1]);for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];switch(t.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[t.nodeName]=parseFloat(t.textContent);break;case"wrapU":case"wrapV":"TRUE"===t.textContent.toUpperCase()?this.texOpts[t.nodeName]=1:this.texOpts[t.nodeName]=parseInt(t.textContent);break;default:this.texOpts[t.nodeName]=t.textContent}}return this},bt.prototype.parse=function(element){for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(t.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[t.nodeName]=(new yt).parse(t);break;case"bump":const e=t.getAttribute("bumptype");e?"heightfield"===e.toLowerCase()?this.bump=(new yt).parse(t):"normalmap"===e.toLowerCase()?this.normal=(new yt).parse(t):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+e+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new yt).parse(t)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new yt).parse(t));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":const n=t.querySelectorAll("float");n.length>0&&(this[t.nodeName]=parseFloat(n[0].textContent))}}return this.create(),this},bt.prototype.create=function(){const t={};let e=!1;if(void 0!==this.transparency&&void 0!==this.transparent){this.transparent;const n=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;n>0&&(e=!0,t.transparent=!0,t.opacity=1-n)}const n={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(const r in this)switch(r){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":const l=this[r];if(l instanceof yt)if(l.isTexture()){const e=l.texture,c=this.effect.sampler[e];if(void 0!==c&&void 0!==c.source){const e=this.effect.surface[c.source];if(void 0!==e){const image=N[e.init_from];if(image){const e=y+image.init_from;let c;const h=o.default.Loader.Handlers.get(e);null!==h?c=h.load(e):(c=new o.default.Texture,zt(c,e)),c.wrapS=l.texOpts.wrapU?o.default.RepeatWrapping:o.default.ClampToEdgeWrapping,c.wrapT=l.texOpts.wrapV?o.default.RepeatWrapping:o.default.ClampToEdgeWrapping,c.offset.x=l.texOpts.offsetU,c.offset.y=l.texOpts.offsetV,c.repeat.x=l.texOpts.repeatU,c.repeat.y=l.texOpts.repeatV,t[n[r]]=c,"emission"===r&&(t.emissive=16777215)}}}}else"diffuse"!==r&&e||("emission"===r?t.emissive=l.color.getHex():t[r]=l.color.getHex());break;case"shininess":t[r]=this[r];break;case"reflectivity":t[r]=this[r],t[r]>0&&(t.envMap=O.defaultEnvMap),t.combine=o.default.MixOperation;break;case"index_of_refraction":t.refractionRatio=this[r],1!==this[r]&&(t.envMap=O.defaultEnvMap)}switch(t.shading=M,t.side=this.effect.doubleSided?o.default.DoubleSide:o.default.FrontSide,void 0!==t.diffuse&&(t.color=t.diffuse,delete t.diffuse),this.type){case"constant":null!=t.emissive&&(t.color=t.emissive),this.material=new o.default.MeshBasicMaterial(t);break;case"phong":case"blinn":this.material=new o.default.MeshPhongMaterial(t);break;default:this.material=new o.default.MeshLambertMaterial(t)}return this.material},wt.prototype.parse=function(element){for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(t.nodeName){case"init_from":this.init_from=t.textContent;break;case"format":this.format=t.textContent;break;default:console.log("unhandled Surface prop: "+t.nodeName)}}return this},xt.prototype.parse=function(element){for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(t.nodeName){case"source":this.source=t.textContent;break;case"minfilter":this.minfilter=t.textContent;break;case"magfilter":this.magfilter=t.textContent;break;case"mipfilter":this.mipfilter=t.textContent;break;case"wrap_s":this.wrap_s=t.textContent;break;case"wrap_t":this.wrap_t=t.textContent;break;default:console.log("unhandled Sampler2D prop: "+t.nodeName)}}return this},Nt.prototype.create=function(){if(null===this.shader)return null},Nt.prototype.parse=function(element){this.id=element.getAttribute("id"),this.name=element.getAttribute("name"),Ft(this,element),this.shader=null;for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType&&"profile_COMMON"===t.nodeName)this.parseTechnique(this.parseProfileCOMMON(t))}return this},Nt.prototype.parseNewparam=function(element){const t=element.getAttribute("sid");for(let i=0;i<element.childNodes.length;i++){const e=element.childNodes[i];if(1==e.nodeType)switch(e.nodeName){case"surface":this.surface[t]=new wt(this).parse(e);break;case"sampler2D":this.sampler[t]=new xt(this).parse(e);break;case"extra":break;default:console.log(e.nodeName)}}},Nt.prototype.parseProfileCOMMON=function(element){let t;for(let i=0;i<element.childNodes.length;i++){const e=element.childNodes[i];if(1==e.nodeType)switch(e.nodeName){case"profile_COMMON":this.parseProfileCOMMON(e);break;case"technique":t=e;break;case"newparam":this.parseNewparam(e);break;case"image":const n=(new H).parse(e);N[n.id]=n;break;case"extra":break;default:console.log(e.nodeName)}}return t},Nt.prototype.parseTechnique=function(element){for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(t.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new bt(t.nodeName,this).parse(t);break;case"extra":this.parseExtra(t)}}},Nt.prototype.parseExtra=function(element){for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType&&"technique"===t.nodeName)this.parseExtraTechnique(t)}},Nt.prototype.parseExtraTechnique=function(element){for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType&&"bump"===t.nodeName)this.shader.parse(element)}},kt.prototype.parse=function(element){return this.url=element.getAttribute("url").replace(/^#/,""),this},vt.prototype.parse=function(element){this.id=element.getAttribute("id"),this.name=element.getAttribute("name"),this.source={};for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(t.nodeName){case"animation":const e=(new vt).parse(t);for(const t in e.source)this.source[t]=e.source[t];for(let t=0;t<e.channel.length;t++)this.channel.push(e.channel[t]),this.sampler.push(e.sampler[t]);break;case"source":const n=(new mt).parse(t);this.source[n.id]=n;break;case"sampler":this.sampler.push(new _t(this).parse(t));break;case"channel":this.channel.push(new Tt(this).parse(t))}}return this},Tt.prototype.parse=function(element){this.source=element.getAttribute("source").replace(/^#/,""),this.target=element.getAttribute("target");let t=this.target.split("/");t.shift();const e=t.shift(),n=e.includes("."),o=e.includes("(");if(n)t=e.split("."),this.sid=t.shift(),this.member=t.shift();else if(o){const t=e.split("(");this.sid=t.shift();for(let e=0;e<t.length;e++)t[e]=parseInt(t[e].replace(/\)/,""));this.arrIndices=t}else this.sid=e;return this.fullSid=e,this.dotSyntax=n,this.arrSyntax=o,this},_t.prototype.parse=function(element){this.id=element.getAttribute("id"),this.inputs=[];for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType&&"input"===t.nodeName)this.inputs.push((new ft).parse(t))}return this},_t.prototype.create=function(){for(let i=0;i<this.inputs.length;i++){const input=this.inputs[i],source=this.animation.source[input.source];switch(input.semantic){case"INPUT":this.input=source.read();break;case"OUTPUT":this.output=source.read(),this.strideOut=source.accessor.stride;break;case"INTERPOLATION":this.interpolation=source.read();break;case"IN_TANGENT":case"OUT_TANGENT":break;default:console.log(input.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(let i=0;i<this.input.length;i++)this.startTime=Math.min(this.startTime,this.input[i]),this.endTime=Math.max(this.endTime,this.input[i]);this.duration=this.endTime-this.startTime}},_t.prototype.getData=function(t,e,n){let data;if("matrix"===t&&16===this.strideOut)data=this.output[e];else if(this.strideOut>1){data=[],e*=this.strideOut;for(let i=0;i<this.strideOut;++i)data[i]=this.output[e+i];if(3===this.strideOut)switch(t){case"rotate":case"translate":Bt(data,-1);break;case"scale":Bt(data,1)}else 4===this.strideOut&&"matrix"===t&&Bt(data,-1)}else data=this.output[e],n&&"translate"===t&&(data=function(t,data){if(!0!==O.convertUpAxis||I===O.upAxis)return data;switch(t){case"X":data="XtoY"===V?-1*data:data;break;case"Y":data="YtoZ"===V||"YtoX"===V?-1*data:data;break;case"Z":data="ZtoY"===V?-1*data:data}return data}(n,data));return data},At.prototype.addTarget=function(t,e,n,data){this.targets.push({sid:t,member:n,transform:e,data:data})},At.prototype.apply=function(t){for(let i=0;i<this.targets.length;++i){const e=this.targets[i];t&&e.sid!==t||e.transform.update(e.data,e.member)}},At.prototype.getTarget=function(t){for(let i=0;i<this.targets.length;++i)if(this.targets[i].sid===t)return this.targets[i];return null},At.prototype.hasTarget=function(t){for(let i=0;i<this.targets.length;++i)if(this.targets[i].sid===t)return!0;return!1},At.prototype.interpolate=function(t,time){for(let i=0,e=this.targets.length;i<e;i++){const e=this.targets[i],n=t.getTarget(e.sid);let data;if("matrix"!==e.transform.type&&n){let o=(time-this.time)/(t.time-this.time);const r=n.data,l=e.data;if(o<0&&(o=0),o>1&&(o=1),l.length){data=[];for(let t=0;t<l.length;++t)data[t]=l[t]+(r[t]-l[t])*o}else data=l+(r-l)*o}else data=e.data;e.transform.update(data,e.member)}},Ct.prototype.parse=function(element){this.id=element.getAttribute("id"),this.name=element.getAttribute("name");for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType&&"optics"===t.nodeName)this.parseOptics(t)}return this},Ct.prototype.parseOptics=function(element){for(let i=0;i<element.childNodes.length;i++)if("technique_common"===element.childNodes[i].nodeName){const t=element.childNodes[i];for(let e=0;e<t.childNodes.length;e++)if(this.technique=t.childNodes[e].nodeName,"perspective"===this.technique){const n=t.childNodes[e];for(let t=0;t<n.childNodes.length;t++){const param=n.childNodes[t];switch(param.nodeName){case"yfov":this.yfov=param.textContent;break;case"xfov":this.xfov=param.textContent;break;case"znear":this.znear=param.textContent;break;case"zfar":this.zfar=param.textContent;break;case"aspect_ratio":this.aspect_ratio=param.textContent}}}else if("orthographic"===this.technique){const n=t.childNodes[e];for(let t=0;t<n.childNodes.length;t++){const param=n.childNodes[t];switch(param.nodeName){case"xmag":this.xmag=param.textContent;break;case"ymag":this.ymag=param.textContent;break;case"znear":this.znear=param.textContent;break;case"zfar":this.zfar=param.textContent;break;case"aspect_ratio":this.aspect_ratio=param.textContent}}}}return this},jt.prototype.parse=function(element){return this.url=element.getAttribute("url").replace(/^#/,""),this},Mt.prototype.parse=function(element){this.id=element.getAttribute("id"),this.name=element.getAttribute("name");for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(t.nodeName){case"technique_common":this.parseCommon(t);break;case"technique":this.parseTechnique(t)}}return this},Mt.prototype.parseCommon=function(element){for(let i=0;i<element.childNodes.length;i++)switch(element.childNodes[i].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=element.childNodes[i].nodeName;const t=element.childNodes[i];for(let e=0;e<t.childNodes.length;e++){const n=t.childNodes[e];switch(n.nodeName){case"color":const t=Rt(n.textContent);this.color=new o.default.Color(0),this.color.setRGB(t[0],t[1],t[2]),this.color.a=t[3];break;case"falloff_angle":this.falloff_angle=parseFloat(n.textContent);break;case"quadratic_attenuation":const e=parseFloat(n.textContent);this.distance=e?Math.sqrt(1/e):0}}}return this},Mt.prototype.parseTechnique=function(element){this.profile=element.getAttribute("profile");for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if("intensity"===t.nodeName)this.intensity=parseFloat(t.textContent)}return this},Ot.prototype.parse=function(element){return this.url=element.getAttribute("url").replace(/^#/,""),this},St.prototype.parse=function(element){this.id=element.getAttribute("id"),this.name=element.getAttribute("name"),this.joints=[],this.links=[];for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType&&"technique_common"===t.nodeName)this.parseCommon(t)}return this},St.prototype.parseCommon=function(element){for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(element.childNodes[i].nodeName){case"joint":this.joints.push((new It).parse(t));break;case"link":this.links.push((new qt).parse(t))}}return this},It.prototype.parse=function(element){this.sid=element.getAttribute("sid"),this.name=element.getAttribute("name"),this.axis=new o.default.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;const t=Rt(element.querySelector("axis").textContent);this.axis=Dt(t,0);const e=element.querySelector("limits min")?parseFloat(element.querySelector("limits min").textContent):-360,n=element.querySelector("limits max")?parseFloat(element.querySelector("limits max").textContent):360;this.limits={min:e,max:n};const r=["prismatic","revolute"];for(let i=0;i<r.length;i++){const t=r[i];element.querySelector(t)&&(this.type=t)}return this.limits.min>=this.limits.max&&(this.static=!0),this.middlePosition=(this.limits.min+this.limits.max)/2,this},qt.prototype.parse=function(element){this.sid=element.getAttribute("sid"),this.name=element.getAttribute("name"),this.transforms=[],this.attachments=[];for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(t.nodeName){case"attachment_full":this.attachments.push((new Vt).parse(t));break;case"rotate":case"translate":case"matrix":this.transforms.push((new tt).parse(t))}}return this},Vt.prototype.parse=function(element){this.joint=element.getAttribute("joint").split("/").pop(),this.links=[];for(let i=0;i<element.childNodes.length;i++){const t=element.childNodes[i];if(1==t.nodeType)switch(t.nodeName){case"link":this.links.push((new qt).parse(t));break;case"rotate":case"translate":case"matrix":this.transforms.push((new tt).parse(t))}}return this},{load:function(t,e,n,o){let r=0;if(document.implementation&&document.implementation.createDocument){const c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState?0!==c.status&&200!==c.status||(c.response?(l=e,X(c.response,void 0,t)):o?o():console.error("ColladaLoader: Empty or non-existing file ("+t+")")):3===c.readyState&&n&&(0===r&&(r=c.getResponseHeader("Content-Length")),n({total:r,loaded:c.responseText.length}))},c.open("GET",t,!0),c.send(null)}else alert("Don't know how to parse XML!")},parse:X,setPreferredShading:function(t){M=t},applySkin:F,geometries:T,options:O}}}}]);